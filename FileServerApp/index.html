<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Index</title>
    <script src="https://unpkg.com/vue"></script>
    <style>
    * {
        box-sizing: border-box;
        font-family: sans-serif;
    }

    body {
        margin: 0;
        padding: 0;
        display: flow-root;
        min-height: 100vh;
        background-color: #fcfcfc;
    }

    ul, ol {
        margin: 0;
        padding: 0;
        display: flow-root;
    }

    li {
        list-style-type: none;
        display: flow-root;
    }

    .item-dir, .item-file, 
    .item-dir span, .item-file span,
    .item-dir a, .item-file a {
        font-weight: normal;
        text-decoration: none;
    }

    .item-dir, .item-file {
        padding: 4px 10px;
        border-radius: 4px;
        transition-duration: 0.3s;
        cursor: pointer;
        user-select: none;
    }


    .item-dir img, .item-file img {
        float: left; 
        margin-right: 1em;
    }

    .item-name-text {
        display: inline-block;
        min-width: 80%;
        font-size: 100%;
        line-height: 160%;
        font-weight: normal;
        color: #111111;
    }

    .item-size-text, .item-lastmod-text {
        display: inline-block;
        min-width: 30%;
        font-size: 75%;
        text-decoration: none;
        font-weight: normal;
        color: #bebebe;
    }

    @media screen and (min-width: 4.50in) {
        body>main {
            width: max(4.40in, 60%);
            margin: 3em auto;
            padding: 2em;
            border: 1px solid #eeeeee;
            border-radius: 8px;
            box-shadow: 0 0 10px 1px rgb(100 100 100 / 10%);
            background-color: #fefefe;
            max-height: 85vh;
            overflow-y: auto;
        }
        
        .item-dir:hover, .item-file:hover {
            background-color: #eef3fe;
        }
    }

    @media screen and (max-width: 4.49in) {
        body {
            background-color: #fefefe;
        }

        body>main {
            width: 100%;
            padding: 0.5em;
        }

        .item-dir, .item-file {
            padding: 4px 4px;
            border-radius: 0;
            border-top: 1px solid #dedede;
        }

        .item-name-text {
            line-height: 120%;
        }

        .item-size-text, .item-lastmod-text {
            min-width: 25%;
        }

        .item-dir img, .item-file img {
            width: 1em;
            margin-right: 2px;
        }
    }
    </style>
</head>
<body>
    <main id="main">
        <p>Base: {{base}}</p>
        <ul>
            <li class="item-dir" @click="goToParent()">
                <img src="/assets?path=/img/icon-back.svg"/>
                <span class="item-name-text">..</span>
                <span class="item-size-text">Parent directory</span>
            </li>
            <li v-for="dir in dirs" class="item-dir" @click="goToDir(dir.Name)">
                <img src="/assets?path=/img/icon-dir.svg"/>
                <span class="item-name-text">{{dir.Name}}</span>
                <br/>
                <span class="item-size-text">Subdirectory</span>
                <span class="item-lastmod-text">Last modified: {{dir.LastModified}}</span>
            </li>
            <li v-for="file in files" class="item-file">
                <a :href="(dirUrlPrefix + base + file.Name)" target="blank">
                    <img src="/assets?path=/img/icon-file.svg"/>
                    <span class="item-name-text">{{file.Name}}</span>
                    <br/>
                    <span class="item-size-text">Size: {{file.Size}} bytes</span>
                    <span class="item-lastmod-text">Last modified: {{file.LastModified}}</span>
                </a>
            </li>
        </ul>
    </main>
    <script type="text/javascript">
    // Default http fail handler
    function defaultFail (http) {
        console.warn("Request failed:");
        console.warn("URL: " + http.responseURL);
        console.warn("Status: " + http.status);
        console.log(http.response);
    }

    // Boilerplate
    function beginHttpGet (url, success, fail = defaultFail) {
        var http = new XMLHttpRequest();
        http.open("GET", url);
        http.onreadystatechange = function() {
            if (http.readyState == XMLHttpRequest.DONE) {
                if (http.status >= 200 && http.status < 300) {
                    success(http);
                }
                else {
                    fail(http);
                }
            }
        };
        http.send();
    }

    var app = new Vue({
        el: "#main",
        data: {
            dirUrlPrefix: "/fs?path=",
            parent: "",
            base: "",
            dirs: [],
            files: []
        },
        methods: {
            goTo: function(dirName){
                var url = this.dirUrlPrefix + dirName;
                var capturedThis = this;
                beginHttpGet(url, function(http){
                    var response = (http.responseType == "json") ? 
                        http.response : JSON.parse(http.response);
                    console.log(http.response);
                    capturedThis.base = response["Base"];
                    capturedThis.dirs = response["Dirs"];
                    capturedThis.files = response["Files"];
                    capturedThis.parent = response["Parent"];
                });
            },
            goToDir: function(dirName){
                this.goTo(this.base + dirName);
            },
            goToParent: function(){
                this.goTo(this.parent);
            },
            start: function(){
                this.goToDir(this.base);
            }
        }
    });

    app.start();
    </script>
</body>
</html>